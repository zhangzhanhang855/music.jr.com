<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ–—åœ°ä¸» 1v1 Â· æš´å‡»ç‰¹æ•ˆç‰ˆ</title>
    <style>
        :root { 
            --bg: #0f172a; 
            --gold: #fbbf24; 
            --card-w: 85px; 
            --card-h: 120px;
            --danger: #ef4444;
        }
        body { margin: 0; background: var(--bg); font-family: "Segoe UI", sans-serif; color: white; overflow: hidden; }

        /* ç‰¹æ•ˆåŠ¨ç”»å®šä¹‰ */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            50% { transform: translate(-1px, 2px) rotate(1deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            100% { transform: translate(1px, -2px) rotate(0deg); }
        }
        .bomb-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        
        @keyframes flash {
            0% { background: var(--bg); }
            50% { background: #450a0a; }
            100% { background: var(--bg); }
        }
        .bomb-flash { animation: flash 0.4s ease-in-out; }

        /* ç•Œé¢å¸ƒå±€ */
        #header { 
            height: 60px; background: rgba(30, 41, 59, 0.8); 
            display: flex; align-items: center; justify-content: space-around;
            border-bottom: 1px solid #334155; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        #stage { height: calc(100vh - 60px); position: relative; display: flex; flex-direction: column; transition: background 0.2s; }

        /* æŒ‰é’®å¤–è§‚ä¼˜åŒ– */
        .btn-group { position: absolute; bottom: 180px; width: 100%; display: flex; justify-content: center; gap: 20px; opacity: 0; pointer-events: none; transition: 0.3s; }
        .btn-group.active { opacity: 1; pointer-events: auto; }

        button { 
            padding: 12px 35px; border-radius: 8px; border: none; font-weight: bold; 
            text-transform: uppercase; cursor: pointer; transition: all 0.2s;
            background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
            color: #451a03; box-shadow: 0 4px 0 #92400e, 0 8px 15px rgba(0,0,0,0.3);
        }
        button:hover { transform: translateY(-2px); filter: brightness(1.1); }
        button:active { transform: translateY(2px); box-shadow: 0 0 0 #92400e; }
        button:disabled { background: #475569; box-shadow: 0 4px 0 #1e293b; color: #94a3b8; cursor: not-allowed; }
        
        #btn-pass { background: linear-gradient(135deg, #94a3b8 0%, #475569 100%); color: white; box-shadow: 0 4px 0 #1e293b; }

        /* å¡ç‰Œæ ·å¼ */
        .hand { width: 100%; display: flex; justify-content: center; padding: 20px 0; min-height: 140px; }
        .card {
            width: var(--card-w); height: var(--card-h); background: white; border-radius: 10px;
            color: black; margin-left: -55px; position: relative;
            display: flex; flex-direction: column; padding: 8px; box-sizing: border-box;
            box-shadow: -2px 0 10px rgba(0,0,0,0.3); transition: transform 0.2s, margin-top 0.2s;
            user-select: none; border: 1px solid #cbd5e1;
        }
        .card:first-child { margin-left: 0; }
        .card.selected { margin-top: -35px; border: 3px solid #f59e0b; box-shadow: 0 0 20px rgba(245, 158, 11, 0.6); }
        .card.red { color: var(--danger); }
        .card .v { font-size: 26px; font-weight: 800; line-height: 1; }
        .card.back { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 1px solid #334155; }

        /* æ¡Œé¢åŒº */
        #desk { flex: 1; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .desk-slot { height: 130px; display: flex; justify-content: center; width: 100%; align-items: center; }
        .status-text { font-size: 30px; font-weight: 900; color: rgba(255,255,255,0.2); font-style: italic; }
    </style>
</head>
<body>

<div id="header">
    <div style="font-weight: bold; color: var(--gold);">æ–—åœ°ä¸» 1V1 Â· æé€Ÿå¯¹å†³</div>
    <div>ç”µè„‘æ‰‹ç‰Œ: <span id="comp-count">0</span> å¼ </div>
    <button onclick="initGame()" style="padding: 5px 15px; font-size: 12px;">é‡å¼€</button>
</div>

<div id="stage">
    <div id="hand-1" class="hand"></div>
    
    <div id="desk">
        <div id="desk-1" class="desk-slot"></div>
        <div id="desk-0" class="desk-slot"></div>
    </div>

    <div class="btn-group" id="ui">
        <button onclick="handlePlay()">å‡ºç‰Œ</button>
        <button id="btn-pass" onclick="handlePass()">ä¸è¦</button>
    </div>
    
    <div id="hand-0" class="hand"></div>
</div>

<script>
const POWER = { '3':3,'4':4,'5':5,'6':6,'7':7,'8':8,'9':9,'10':10,'J':11,'Q':12,'K':13,'A':14,'2':15,'å°ç‹':16,'å¤§ç‹':17 };
let G = { hands: [[], []], last: null, turn: 0, selected: new Set() };

function initGame() {
    let deck = [];
    for(let v in POWER) {
        if(v.includes('ç‹')) deck.push({v, p:POWER[v], s:'ğŸƒ', c:v==='å¤§ç‹'?'red':'black'});
        else ['â™ ','â™¥','â™£','â™¦'].forEach(s => deck.push({v, p:POWER[v], s, c:(s==='â™¥'||s==='â™¦'?'red':'black')}));
    }
    deck.sort(() => Math.random() - 0.5);
    
    // 1v1 å¹³åˆ†ä¸€å‰¯ç‰Œï¼Œæ¯äºº27å¼ 
    G.hands = [
        deck.slice(0, 27).sort((a,b)=>b.p-a.p),
        deck.slice(27, 54).sort((a,b)=>b.p-a.p)
    ];
    G.last = null; G.turn = 0; G.selected.clear();
    renderAll();
    checkTurn();
}

function getInfo(cards) {
    if(!cards.length) return null;
    let counts = {};
    cards.forEach(c => counts[c.p] = (counts[c.p] || 0) + 1);
    let sorted = Object.entries(counts).map(e=>({p:Number(e[0]), c:e[1]})).sort((a,b)=>b.c - a.c || b.p - a.p);
    let len = cards.length;
    let main = sorted[0];

    // ç‚¸å¼¹åˆ¤æ–­
    if(main.c === 4 && len === 4) return { type: 'bomb', p: main.p };
    if(len === 2 && cards[0].p >= 16 && cards[1].p >= 16) return { type: 'bomb', p: 99 };

    if(len === 1) return { type: 'single', p: main.p };
    if(len === 2 && main.c === 2) return { type: 'pair', p: main.p };
    if(len === 3 && main.c === 3) return { type: 'trio', p: main.p };
    
    // é¡ºå­
    if(len >= 5 && sorted.every(e => e.c === 1)) {
        let ps = sorted.map(e=>e.p).sort((a,b)=>a-b);
        if(ps[len-1] < 15 && ps[len-1]-ps[0] === len-1) return { type: 'straight', p: ps[0], len };
    }
    return null;
}

function triggerBombEffect() {
    const stage = document.getElementById('stage');
    stage.classList.add('bomb-shake', 'bomb-flash');
    setTimeout(() => {
        stage.classList.remove('bomb-shake', 'bomb-flash');
    }, 500);
}

function renderAll() {
    const h0 = document.getElementById('hand-0');
    h0.innerHTML = G.hands[0].map((c, i) => `
        <div class="card ${c.c} ${G.selected.has(i)?'selected':''}" onclick="toggleCard(${i})">
            <span class="v">${c.v}</span><span style="font-size:12px">${c.s}</span>
        </div>
    `).join('');
    
    document.getElementById('hand-1').innerHTML = G.hands[1].map(() => `<div class="card back" style="margin-left:-65px"></div>`).join('');
    document.getElementById('comp-count').innerText = G.hands[1].length;
    document.getElementById('ui').className = G.turn === 0 ? 'btn-group active' : 'btn-group';
    document.getElementById('btn-pass').disabled = !G.last || G.last.player === 0;
}

function toggleCard(i) {
    if(G.selected.has(i)) G.selected.delete(i); else G.selected.add(i);
    renderAll();
}

function handlePlay() {
    let cards = Array.from(G.selected).map(i => G.hands[0][i]);
    let info = getInfo(cards);
    if(!info) return;

    if(G.last && G.last.player !== 0) {
        let l = getInfo(G.last.cards);
        if(info.type === 'bomb') {
            if(l.type === 'bomb' && info.p <= l.p) return;
        } else {
            if(info.type !== l.type || info.len !== l.len || info.p <= l.p) return;
        }
    }
    if(info.type === 'bomb') triggerBombEffect();
    execute(cards);
}

function handlePass() {
    document.getElementById(`desk-${G.turn}`).innerHTML = '<span class="status-text">PASS</span>';
    nextTurn();
}

function execute(cards) {
    G.hands[G.turn] = G.hands[G.turn].filter(c => !cards.includes(c));
    G.last = { player: G.turn, cards };
    document.getElementById(`desk-${G.turn}`).innerHTML = cards.map(c => `
        <div class="card ${c.c}" style="margin-left:-50px; transform:scale(0.9); cursor:default">
            <span class="v">${c.v}</span><span>${c.s}</span>
        </div>
    `).join('');
    if(G.hands[G.turn].length === 0) return alert(G.turn === 0 ? "èƒœåˆ©ï¼" : "å¤±è´¥...");
    G.selected.clear();
    nextTurn();
}

function nextTurn() {
    G.turn = 1 - G.turn;
    document.getElementById(`desk-${G.turn}`).innerHTML = "";
    renderAll();
    checkTurn();
}

function checkTurn() {
    if(G.turn === 1) setTimeout(aiPlay, 1000);
}

function aiPlay() {
    const hand = G.hands[1];
    let toPlay = [];
    if(!G.last || G.last.player === 1) {
        toPlay = [hand[hand.length-1]];
    } else {
        const l = getInfo(G.last.cards);
        // å°è¯•å‹ç‰Œ
        for(let i=0; i<hand.length; i++) {
            for(let j=i; j<Math.min(i+10, hand.length); j++) {
                let sub = hand.slice(i, j+1);
                let info = getInfo(sub);
                if(info && (info.type === l.type || info.type === 'bomb') && (info.len === l.len || info.type === 'bomb') && info.p > l.p) {
                    toPlay = sub; break;
                }
            }
            if(toPlay.length) break;
        }
    }
    if(toPlay.length) {
        if(getInfo(toPlay).type === 'bomb') triggerBombEffect();
        execute(toPlay);
    } else handlePass();
}

initGame();
</script>
</body>
</html>
